<div id="task_summary_outer">
    <div id="EditProfile_container">
        <div id="EditProfile_wrapper">
            <div id="EditProfile">
                <h2>Kirkland &amp; Ellis Offer Letter Details</h2>
                <div class="heading">
                    <span class="heading-inner">
                        Offer Letter Input Variables
                    </span>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Offer Letter Date" data-fieldgroup-validation="required">
                    <span class="floating-label">Offer Letter Date</span>
                    <input readonly type="text" id="Pseudo_Offer_Letter_Date" name="Pseudo_Offer_Letter_Date" value="">
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Name of Offer Writer">
                    <span class="floating-label">Name of Offer Writer</span>
                    <$client.env.inputOffer_Writer_Name>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Number of Offer Writerr">
                    <span class="floating-label">Number of Offer Writer</span>
                    <$client.env.inputOffer_Writer_Number>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Email Address of Offer Writer">
                    <span class="floating-label">Email Address of Offer Writer</span>
                    <$client.env.inputOffer_Writer_Email>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Position Title of Offer Writer">
                    <span class="floating-label">Position Title of Offer Writer</span>
                    <$client.env.inputOffer_Writer_Title>
                </div>
                <div class="mb-18"></div>

                <div class="heading">
                    <span class="heading-inner">
                        Compensation
                    </span>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Salary Amount" data-fieldgroup-validation="required">
                    <span class="floating-label">Salary Amount</span>
                    <$client.env.inputSalary_Amount>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Currency" data-fieldgroup-validation="required">
                    <span class="floating-label">Currency</span>
                    <$client.env.inputSalary_Amount_Currency_Code>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Class Year" data-fieldgroup-validation="required">
                    <span class="floating-label">Class Year</span>
                    <$client.env.inputclass_year>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Guaranteed_Bonus_Eligible" data-fieldgroup-validation="required" data-fieldgroup-targetlabel="#Guaranteed_Bonus_Eligible_label">
                    <label id="Guaranteed_Bonus_Eligible_label">
                        <strong>Is the New Joiner eligible for a Guaranteed Bonus?</strong>
                    </label>
                    <$client.env.inputGuaranteed_Bonus_Eligible>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Guaranteed Bonus Type" data-fieldgroup-validation="required">
                    <span class="floating-label">Guaranteed Bonus Type</span>
                    <$client.env.inputGuaranteed_Bonus_Type>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Guaranteed Bonus Amount" data-fieldgroup-validation="required">
                    <span class="floating-label">Guaranteed Bonus Amount</span>
                    <$client.env.inputGuaranteed_Bonus_Amount>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Guaranteed Bonus Amount Currency" data-fieldgroup-validation="required">
                    <span class="floating-label">Guaranteed Bonus Amount Currency</span>
                    <$client.env.inputGuaranteed_Bonus_Amount_Currency>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="GB paid as class year" data-fieldgroup-validation="required">
                    <span class="floating-label">GB paid as class year</span>
                    <$client.env.inputGB_Paid_Class_Year>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Year GB is Paid to candidate" data-fieldgroup-validation="required">
                    <span class="floating-label">Year GB is Paid to candidate</span>
                    <$client.env.inputGB_Year_Paid>
                </div>
                <div class="mb-18"></div>

                <div class="heading">
                    <span class="heading-inner">
                        Additional Bonus
                    </span>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Signing_Bonus_Eligible" data-fieldgroup-validation="required" data-fieldgroup-targetlabel="#Signing_Bonus_Eligible_label">
                    <label id="Signing_Bonus_Eligible_label">
                        <strong>Is the New Joiner eligible for a Signing Bonus?</strong>
                    </label>
                    <$client.env.inputSigning_Bonus_Eligible>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Signing Bonus Amount" data-fieldgroup-validation="required">
                    <span class="floating-label">Signing Bonus Amount</span>
                    <$client.env.inputSigning_Bonus_Amount>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Signing Bonus Currency" data-fieldgroup-validation="required">
                    <span class="floating-label">Signing Bonus Currency</span>
                    <$client.env.inputSigning_Bonus_Currency_Code>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Clerkship_Bonus_Eligibleigible" data-fieldgroup-validation="required" data-fieldgroup-targetlabel="#Clerkship_Bonus_Eligible_label">
                    <label id="Clerkship_Bonus_Eligible_label">
                        <strong>Is the New Joiner eligible for a Clerkship Bonus?</strong>
                    </label>
                    <$client.env.inputClerkship_Bonus_Eligible>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Clerkship Bonus Amount" data-fieldgroup-validation="required">
                    <span class="floating-label">Clerkship Bonus Amount</span>
                    <$client.env.inputClerkship_Bonus_Amount>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Clerkship Bonus Currency" data-fieldgroup-validation="required">
                    <span class="floating-label">Clerkship Bonus Currency</span>
                    <$client.env.inputClerkship_Bonus_Currency_Code>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Expiration_Language" data-fieldgroup-validation="required" data-fieldgroup-targetlabel="#Expiration_Language_label">
                    <label id="Expiration_Language_label">
                        <strong>Include Expiration Language</strong>
                    </label>
                    <$client.env.inputExpiration_Language>
                </div>
                <div class="mb-18"></div>

                <div class="heading">
                    <span class="heading-inner">
                        Relocation
                    </span>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Relocation" data-fieldgroup-validation="required" data-fieldgroup-targetlabel="#Relocation_label">
                    <label id="Relocation_label">
                        <strong>Relocation</strong>
                    </label>
                    <$client.env.inputRelocation>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Relocation Bonus Amount" data-fieldgroup-validation="required">
                    <span class="floating-label">Relocation Bonus Amount</span>
                    <$client.env.inputRelocation_Bonus_Amount>
                </div>
                <div class="input_wrapper" data-fieldgroup-title="Relocation Bonus Currency" data-fieldgroup-validation="required">
                    <span class="floating-label">Relocation Bonus Currency</span>
                    <$client.env.inputRelocation_Bonus_Currency_Code>
                </div>
                <div class="mb-18"></div>


                <div class="button_group">
                    <div id="save" class="input_wrapper clearfix mb-15"></div>
                    <div id="saveandcomplete" class="input_wrapper clearfix"></div>
                    <div id="cancel" class="input_wrapper clearfix"></div>
                </div>

            </div>
        </div>
    </div>
</div>

<div style="display: none;">
    <$client.env.inputDOB>
    <$client.env.inputOffer_Letter_Date>
    <input id="event-location-value" type="text" value="<$client.env.eval(client.tEventCategories_Category_21.Value.length()>0?client.tEventCategories_Category_21.Value:'USA')>">
    <input id="event-location-code" type="text" value="<$client.env.eval(client.tEventCategories_Category_21.Code.length()>0?client.tEventCategories_Category_21.Code:'USA')>">
</div>

<script type="text/javascript" src="<$link;/main/RedCarpet/FormTemplates/FormSupport/js/moment-with-locales.min.js>"></script>
<script type="text/javascript" src="<$link;/main/RedCarpet/FormTemplates/FormSupport/js/global_date_formatter.js>"></script>
<script type="text/javascript" src="<$link;/main/RedCarpet/FormTemplates/FormSupport/js/jquery.mask.min.js>"></script>
<script type="text/javascript" src="<$link;/main/RedCarpet/FormTemplates/FormSupport/js/front_validator.js>" defer></script>
<script type="text/javascript">
    const focusInputLabel = function(el, isFocused) {
        "use strict";
        let label = el.closest('.input_wrapper')
            .find('span.floating-label')
            .removeClass('label-focus')
            .css({"color": "#1C1C1C"});
        if (el.is('select') && el.val() === null) {
            return;
        }
        if (el.val().trim().length > 0 || isFocused) {
            label.addClass('label-focus');
        }
        if (isFocused === true) {
            label.css({"color": "#1C1C1C"});
        }
    }
    const fieldHasVal = function(el) {
        "use strict";
        let hasVal = false;
        $.each(el, function(k, v) {
            if ($(v).val().length) {
                hasVal = true;
            }
        });
        return hasVal;
    }
    const isCheckboxChecked = function(el) {
        "use strict";
        let hasChecked = false;
        $.each(el, function(k,v){
            if ($(v).is(':checked')) {
                hasChecked = true;
            }
        });
        return hasChecked;
    }

    $(window).on('load', function() {
        "use strict";
        $('.floating-label span').css('color', 'rgb(102, 102, 102)');
        $('.cal_and_button').prop({'cellpadding': 0, 'cellspacing': 0});
        let isProfileCompleted = sTaskComplete;
        // replace default submit button with paypal styled
        $('#TaskSummary_ButtonCancel').appendTo('#cancel').show();
        if (!isProfileCompleted) {
            $('#TaskSummary_ButtonSave').appendTo('#saveandcomplete').prop('onclick', null).show().text('Continue');
            $('#EUPDefaultSaveButton').appendTo('#save').show();
        }
        $('textarea').addClass('lifesuite__textarea-input');

        // remove all empty radio
        $('#EditProfile input[type="radio"][value=""]').closest('.horizontal_radio_item').remove();

        // load form when all set
        $('#EditProfile_wrapper').fadeIn();

        <$include;/main/RedCarpet/FormTemplates/FormSupport/js/global_date_config.js>

        // initiate date field
        // country codes set in https://kirkland-staging-redcarpet.silkroad.com/rcng/#/categories/manage
        const countryCodes = [
            {
                "codes": ["15", "01", "16", "14", "04", "05", "10", "07", "02"],
                "country": "USA"
            },
            {
                "codes": ["12", "11"],
                "country": "CHN"
            },
            {
                "codes": ["09"],
                "country": "HKG"
            },
            {
                "codes": ["06"],
                "country": "GBR"
            },
            {
                "codes": ["08"],
                "country": "DEU"
            },
            {
                "codes": ["17"],
                "country": "FRA"
            }
        ];
        const extractCountryFromCode = function(countryCodes, code) {
            for (let i = 0; i < countryCodes.length; i++) {
                if (countryCodes[i].codes.indexOf(code) > -1) {
                    return countryCodes[i].country;
                }
            }
            return "USA";
        }
        const offerLetterDate = $('#Pseudo_Offer_Letter_Date')
            .formatDatePicker(dateConfig, extractCountryFromCode(countryCodes, $('#event-location-code').val()), true)
            .datepicker('setDate', $('[name$=".Offer_Letter_Date_display"]').datepicker('getDate'))
            .datepicker("option", "onSelect", function(dateText, instance) {
                $('[name$=".Offer_Letter_Date_display"]').datepicker('setDate', $(this).datepicker('getDate'));
                validateField($(this)); 
                focusInputLabel($(this));
            });
        if (isProfileCompleted) {
            offerLetterDate.datepicker('destroy').removeClass('hasDatepicker').removeAttr('id name').unbind();
        }

        // set default values
        $('[name$=".Offer_Letter_Date_display"]').on('change');
        $('[name$=".Offer_Letter_Date_display"]').datepicker("option", "onSelect", function(dateText, instance) {
            let offerLetterDate = $(this).datepicker('getDate');
            $('[name$=".Raise_Year"]').val(offerLetterDate.getFullYear() + 2);
        });

        // toggle fields based on values
        // toggle guarateed bonus eliginle dependent field
        $('#EditProfile').on('change', '[name$=".Guaranteed_Bonus_Eligible"]', function() {
            if ($('#EditProfile [name$=".Guaranteed_Bonus_Eligible"]:checked').val() === 'Y') {
                $('#EditProfile [name$=".Guaranteed_Bonus_Type"], #EditProfile [name$=".Guaranteed_Bonus_Amount"], #EditProfile [name$=".Guaranteed_Bonus_Amount_Currency"], #EditProfile [name$=".GB_Paid_Class_Year"]').closest('.input_wrapper').show();
                return;
            }
            let dependents = $('#EditProfile [name$=".Guaranteed_Bonus_Type"], #EditProfile [name$=".Guaranteed_Bonus_Amount"], #EditProfile [name$=".Guaranteed_Bonus_Amount_Currency"], #EditProfile [name$=".GB_Paid_Class_Year"]');
            dependents.closest('.input_wrapper').hide();
            $.each(dependents, function(k, v) {
                validateField($(v).val(''), true);
                focusInputLabel($(v));
            });
            $('#EditProfile [name$=".Guaranteed_Bonus_Type"]').val('').trigger('change');
            return;
        });
        // then trigger it
        $('#EditProfile [name$=".Guaranteed_Bonus_Eligible"]').trigger('change');
        // toggle guarateed bonus type dependent field
        $('#EditProfile').on('change', '[name$=".Guaranteed_Bonus_Type"]', function() {
            if ($(this).val() === 'Standard') {
                $('#EditProfile [name$=".GB_Year_Paid"]').closest('.input_wrapper').show();
                return;
            }
            let dependent = $('#EditProfile [name$=".GB_Year_Paid"]');
            dependent.closest('.input_wrapper').hide();
            validateField(dependent.val(''), true);
            focusInputLabel(dependent);
            return;
        });
        // then trigger it
        $('#EditProfile [name$=".Guaranteed_Bonus_Type"]').trigger('change');
        // toggle signing bonus eligible dependent field
        $('#EditProfile').on('change', '[name$=".Signing_Bonus_Eligible"]', function() {
            if ($('#EditProfile [name$=".Signing_Bonus_Eligible"]:checked').val() === 'Y') {
                $('#EditProfile [name$=".Signing_Bonus_Currency_Code"], #EditProfile [name$=".Signing_Bonus_Amount"]').closest('.input_wrapper').show();
                return;
            }
            let dependent = $('#EditProfile [name$=".Signing_Bonus_Currency_Code"], #EditProfile [name$=".Signing_Bonus_Amount"]');
            dependent.closest('.input_wrapper').hide();
            validateField(dependent.val(''), true);
            focusInputLabel(dependent);
            return;
        });
        // then trigger it
        $('#EditProfile [name$=".Signing_Bonus_Eligible"]').trigger('change');
        // toggle clerkship bonus eligible dependent field
        $('#EditProfile').on('change', '[name$=".Clerkship_Bonus_Eligible"]', function() {
            if ($('#EditProfile [name$=".Clerkship_Bonus_Eligible"]:checked').val() === 'Y') {
                $('#EditProfile [name$=".Clerkship_Bonus_Currency_Code"], #EditProfile [name$=".Clerkship_Bonus_Amount"]').closest('.input_wrapper').show();
                return;
            }
            let dependent = $('#EditProfile [name$=".Clerkship_Bonus_Currency_Code"], #EditProfile [name$=".Clerkship_Bonus_Amount"]');
            dependent.closest('.input_wrapper').hide();
            validateField(dependent.val(''), true);
            focusInputLabel(dependent);
            return;
        });
        // then trigger it
        $('#EditProfile [name$=".Clerkship_Bonus_Eligible"]').trigger('change');
        // toggle relocation dependent field
        $('#EditProfile').on('change', '[name$=".Relocation"]', function() {
            if ($('#EditProfile [name$=".Relocation"]:checked').val() === 'Y') {
                $('#EditProfile [name$=".Relocation_Bonus_Amount"], #EditProfile [name$=".Relocation_Bonus_Currency_Code"]').closest('.input_wrapper').show();
                return;
            }
            let dependents = $('#EditProfile [name$=".Relocation_Bonus_Amount"], #EditProfile [name$=".Relocation_Bonus_Currency_Code"]');
            dependents.closest('.input_wrapper').hide();
            $.each(dependents, function(k, v) {
                validateField($(v).val(''), true);
                focusInputLabel($(v));
            });
            return;
        });
        // then trigger it
        $('#EditProfile [name$=".Relocation"]').trigger('change');

        // field masking
        $('#EditProfile').on('keyup paste', '[name$=".Guaranteed_Bonus_Amount"], [name$=".Relocation_Bonus_Amount"]', function() {
            $(this).mask('000,000,000,000,000,000.00', {reverse: true});
        });


        // focus style text and select fields
        $('form').on('focus', 'input[type="text"], select', function() {
            focusInputLabel($(this), true);
        }).on('blur', 'input[type="text"], select', function() {
            focusInputLabel($(this));
        });
        // focus field labels
        $.each($('form input[type="text"], form select, textarea'),function(k,v) {
            focusInputLabel($(v));
        });

        // pass validation data to each fields
        $.each($('[data-fieldgroup-validation]'), function(k,v) {
            $(v).find('input, select, textarea').data('validation', $(v).data('fieldgroup-validation'));
        });
        // pass regex data to each fields
        $.each($('[data-fieldgroup-regex]'), function(k,v) {
            $(v).find('input, textarea').data('regex', $(v).data('fieldgroup-regex'));
        });
        // pass regex message to each fields
        $.each($('[data-fieldgroup-message]'), function(k,v) {
            $(v).find('input, textarea').data('message', $(v).data('fieldgroup-message'));
        });
        // pass validation data length to each fields
        $.each($('[data-fieldgroup-minlength]'), function(k,v) {
            $(v).find('input, textarea').data('minlength', $(v).data('fieldgroup-minlength'));
        });
        $.each($('[data-fieldgroup-maxlength]'), function(k,v) {
            $(v).find('input, textarea').data('maxlength', $(v).data('fieldgroup-maxlength'));
        });
        // pass target label to each radio or checkbox fields
        $.each($('[data-fieldgroup-targetlabel]'), function(k,v) {
            $(v).find('input[type="checkbox"], input[type="radio"]').data('label', $(v).data('fieldgroup-targetlabel'));
        });
        // pass title data to each fields
        $.each($('[data-fieldgroup-title]'), function(k,v) {
            $(v).find('input, select, textarea').data('title', $(v).data('fieldgroup-title'));
        });

        // validate each field by event and field type
        $('form').on('blur click', 'input[type="text"], input[type="radio"], select, textarea', function() {
            if($(this).is(':visible') && !validateField($(this))) {
                $(this).parent().find('.text-error').css({'display': 'inline-block', 'margin-bottom': '-2px'}); // style hack since IE is such a reliable browser ;-) // changed block to inline-block
            }
        });

        // submit the form if no errors
        $('form').on('click', '#TaskSummary_ButtonSave', function(e) {
            e.preventDefault();
            let formIsValid = true;
            $.each($('form input:not(".datepicker_button"), form select, form textarea'), function(k,v) {
                if($(v).is(':visible') && !validateField($(v))) {
                    formIsValid = false;
                }
            });
            if (formIsValid) {
                doSave_Custom('refer-Complete');
            }
            else {
                $("html, body").animate({ scrollTop: 0 }, "slow");
            }
        });
        if (isProfileCompleted) {
            $('[data-add-section], [data-remove-section]').removeClass('bg-jade bg-ignite').addClass('disabled').prop('disabled', 'disabled');
            $('#EditProfile').find('input,select').prop('disabled', 'disabled');
            // $('#EditProfile input#Pseudo_Offer_Letter_Date').datepicker('destroy');
        }
    });
</script>
