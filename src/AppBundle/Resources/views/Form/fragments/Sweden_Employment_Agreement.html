<!-- Modal E-Signature box: Note there is a DIV below that is also needed to implement --> 
<div class="modal" id="modal" style="display:none;">
   <div class="modal-content">
      <h2 class="lifesuite__h2"><strong>Electronic Signature</strong></h2>
      <p style="fontweight:normal;padding:0px"> 
         <$client.env.eval(client.env.param.verbiage.length()==0? 'I understand that by electronically signing this document by typing my full name below, that I acknowledge, agree and attest that the information provided by me is true and correct and I am freely intending to create and adopt as my own a legally binding electronic signature that carries the same legal effect and enforceability as my handwritten.':client.env.param.verbiage)> 
      </p>
      <br> 
      <div class="row">
         <div class="lifesuite__clearfix"> 
            <b>Type your Name:</b> <input type=text id="eSignature1" class="lifesuite__text-input lifesuite__button.primary:hover ng-invalid" style="width: 99%">&nbsp; 
         </div>
      </div>
      <div class="row">
         <div class="lifesuite__clearfix lifesuite__float-right" style="margin-right:-15px;"> 
            <input type="button" class="lifesuite__button primary" value="Sign" onClick="validateSignature('signature','eSignature1','name','modal','over','sv','SignatureDate');xbObj('eSignature1').value='';document.getElementById('eSignature1').focus();">&nbsp; 
            <input type="button" class="lifesuite__button" value="Clear" onClick="xbObj('signature').value='';showHide('modal');showHide('over');xbObj('eSignature1').value='';if (typeof targetdatecheckCLEAR == 'function' ){targetdatecheckCLEAR('signature','SignatureDate');}">&nbsp; 
            <input type="button" class="lifesuite__button" value="Cancel" onClick="showHide('modal');showHide('over');xbObj('eSignature1').value='';">
         </div>
      </div>
   </div>
</div>
<div class="modal" id="modal2" style="display:none;">
   <div class="modal-content">
      <h2 class="lifesuite__h2"><strong>Electronic Signature</strong></h2>
      <p style="fontweight:normal;padding:0px"> 
         <$client.env.eval(client.env.param.verbiage.length()==0? 'I understand that by electronically signing this document by typing my full name below, that I acknowledge, agree and attest that the information provided by me is true and correct and I am freely intending to create and adopt as my own a legally binding electronic signature that carries the same legal effect and enforceability as my handwritten.':client.env.param.verbiage)> 
      </p>
      <br> 
      <div class="row">
         <div class="lifesuite__clearfix"> 
            <b>Type your Name:</b> <input type=text id="eSignature2" class="lifesuite__text-input lifesuite__button.primary:hover ng-invalid" style="width: 99%">&nbsp; 
         </div>
      </div>
      <div class="row">
         <div class="lifesuite__clearfix lifesuite__float-right" style="margin-right:-15px;"> 
            <input type="button" class="lifesuite__button primary" value="Sign" onClick="validateSignature('signature2','eSignature2','Signatory','modal2','over','sv2','CompanySignatureDate');xbObj('eSignature2').value='';document.getElementById('eSignature2').focus();">&nbsp; 
            <input type="button" class="lifesuite__button" value="Clear" onClick="xbObj('signature2').value='';showHide('modal2');showHide('over');xbObj('eSignature2').value='';if (typeof targetdatecheckCLEAR == 'function' ){targetdatecheckCLEAR('signature','CompanySignatureDate');}">&nbsp; 
            <input type="button" class="lifesuite__button" value="Cancel" onClick="showHide('modal2');showHide('over');xbObj('eSignature2').value='';"> 
         </div>
      </div>
   </div>
</div>

<div id="over" style="display:none;"></div> 
<script> 
    showScreen('over');
</script> 
<!--//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// --> 
  
<!--//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// --> 
<!-- RESPONSIVE eFORM PAGE LOADER--> 
<div class="modal" style="display:block; background: #002E6D;">
   <div class="fb-spinner"> 
      <i class="fa fa-2x fa-spinner fa-pulse"></i> 
   </div>
</div>
<!--//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// --> 
 <form id="sweden-employment-agreement" name="frmForm" action="<$link;config.path.RCFolder_FormTemplates>/<$name;<$client.current.parent>>/doSave?<$client.env.QUERY_STRING>" method="post" onsubmit="return SubmitCallback(this);" role="form"> 

<div style="display:none;">
<$client.env.FormField.Form_Name.prompt>
<$client.env.FormField.Form_Name.HTML>
<$client.env.FormField.Form_Type.prompt>
<$client.env.FormField.Form_Type.HTML>
<$client.env.FormField.Form_Owner.prompt>
<$client.env.FormField.Form_Owner.HTML>
<$client.env.FormField.Form_CreateDate.prompt>
<$client.env.FormField.Form_CreateDate.HTML>
<$client.env.FormField.Form_Completed.prompt>
<$client.env.FormField.Form_Completed.HTML>
<$client.env.FormField.Form_Delivered.prompt>
<$client.env.FormField.Form_Delivered.HTML>
<$client.env.FormField.Form_TaskId.prompt>
<$client.env.FormField.Form_TaskId.HTML>
<$client.env.FormField.display_version.HTML>
<!-- Your Required/Validated Form Fields -->

<$client.env.formfield.CompanySignature.prompt>
<$client.env.formfield.CompanySignatureDate.prompt>
<$client.env.formfield.PrintedSignatoryName.prompt>
<$client.env.formfield.Signature.prompt>
<$client.env.formfield.SignatureDate.prompt>
<$client.env.formfield.PrintedEmployeeName.prompt>
</div>

<input type="hidden" name="tagparamlist" value="<$client.env.tagparamlist>">

<!-- Begin HTML Content -->

<main id="container" class="container-fluid">
     <div class="row" style="margin-bottom: 20px;">
          <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12 imgr">
               <img src="<$link;/RedCarpet/Onboarding/Uploads/Images/paypal_logo.jpg>" class="img-responsive" style="max-width: 120px;">
          </div>
     </div >
     <div class="row" style="margin-bottom: 20px;">
          <div class="center-block inner-wrapper">
               <div id="incomplete"> 
                    <div id="markup"></div>
               </div>
               <div id="complete"></div>
          </div>
     </div >
     <div id="fields">
          <div class="row">
               <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <h5><span class="signature-section-title">Employee:</span></h5>
               </div>
          </div>
          <div class="row">
               <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12">
                    <label class="control-label">Signature: <span class="font-red">*</span> </label> 
               </div>
               <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12">
                    <div class="form-group">
                         <$client.env.FormField.Signature.html>
                    </div>
               </div>
               <div class="col-lg-1 col-md-1 col-sm-12 col-xs-12">
                    <label class="control-label">Date: </label>
               </div>
               <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <div class="form-group" id="sign-date-container">
                         <$client.env.FormField.SignatureDate.html>
                    </div>
               </div>
          </div>
          <div class="row">
               <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12">
                    <label class="control-label">Name: </label>
               </div>
               <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12">
                    <$client.env.FormField.Name.html>
               </div>
          </div>
          <br><br>
          <div class="row">
               <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <h5><span class="signature-section-title">Employer:</span></h5>
               </div>
          </div>
          <div class="row">
               <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12">
                    <label class="control-label">Signature: <span class="font-red">*</span> </label> 
               </div>
               <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12">
                    <div class="form-group">
                         <$client.env.FormField.CompanySignature.html>
                    </div>
               </div>
               <div class="col-lg-1 col-md-1 col-sm-12 col-xs-12">
                    <label class="control-label">Date: </label>
               </div>
               <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <div class="form-group" id="sign-date-container2">
                         <$client.env.FormField.CompanySignatureDate.html>
                    </div>
               </div>
          </div>
          <div class="row">
               <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12">
                    <label class="control-label">Name: </label>
               </div>
               <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12">
                    <$client.env.FormField.Signatory.html>
               </div>
          </div>
     </div>
     <div class="row" style="margin-bottom: 20px;">
          <div class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 inner-wrapper">
               <div id="incomplete2">
               </div>
               <div id="complete2"></div>
          </div>
     </div >
     <hr class="lifesuite__hr">
     <div class="row" id="formButtons" style="display: none;">
          <div class="lifesuite__clearfix lifesuite__float-right">                
               <$client.env.FormButtons> 
          </div>
     </div>
</main> 

<div style="display:none;">
<div id="markup2"></div>
<div id="markup3"></div>
<$client.env.formfield.headerpg1.html>
<$client.env.formfield.hidden_pg.html>
<$client.env.formfield.hidden_pg2.html>
<$client.env.formfield.hidden_pg3.html>
<$client.env.formfield.hidden_pg4.html>
<$client.env.formfield.hidden_pg5.html>
<$client.env.formfield.Recruiter_Signature.html>
<$client.env.formfield.SignatureVerification.html>
<$client.env.formfield.SignatureVerification2.html>
<$client.env.formfield.State.html>
<$client.env.FormField.CompanyName.html>
<$client.env.FormField.EmployeeStamp.html>
<$client.env.FormField.SignatoryStamp.html>
</div>

</form>

<script type="text/javascript" src="<$link;/main/RedCarpet/FormTemplates/FormSupport/js/bootstrap.min.js>"></script> 
<script type="text/javascript" src="<$link;/main/RedCarpet/FormTemplates/FormSupport/js/front_validator.js>"></script> 
<script type="text/javascript" src="<$link;/main/RedCarpet/FormTemplates/Sweden_Employment_Agreement/js/script_Version_2.js>"></script>

<script type="text/javascript"> 
//Show populated form if already completed
const disableCalButton = function(className) {
  "use strict";
  $(className).parent().find('input').prop('disabled', true);
}
ChangeCalendarIcons(); //for popup calendar  
$(window).ready(function() { 
        $("#buttonCancel").removeClass("appInputButton RCappInputButtonOrange RCappInputButtonBlue"); 
        $("#buttonCancel").addClass("lifesuite__button"); 
        $('#buttonCancel').attr('id','ButtonCancel'); 
        $("#buttonSave").removeClass("appInputButton RCappInputButtonBlue"); 
        $("#buttonSave").addClass("lifesuite__button primary"); 
        $('#buttonSave').attr('id','ButtonSave'); 
        $("#buttonSaveAndComplete").removeClass("appInputButton RCappInputButtonBlue"); 
        $("#buttonSaveAndComplete").addClass("lifesuite__button primary"); 
        $('#buttonSaveAndComplete').attr('id','ButtonSaveAndComplete'); 
        $("#buttonPrint").removeClass("appInputButton RCappInputButtonOrange RCappInputButtonBlue"); 
        $("#buttonPrint").addClass("lifesuite__button"); 
        $('#buttonPrint').attr('id','ButtonPrint'); 
        $("#buttonPreviewDelete").removeClass("appInputButton RCappInputButtonRed"); 
        $("#buttonPreviewDelete").addClass("lifesuite__button"); 
        $('#buttonPreviewDelete').attr('id','ButtonPreviewDelete'); 
        $("#buttonPreviewSave").removeClass("appInputButton RCappInputButtonBlue"); 
        $("#buttonPreviewSave").addClass("lifesuite__button primary"); 
        $('#buttonPreviewSave').attr('id','ButtonPreviewSave'); 
        $("#buttonComplete").removeClass("appInputButton RCappInputButtonBlue"); 
        $("#buttonComplete").addClass("lifesuite__button primary"); 
        $('#buttonComplete').attr('id','ButtonComplete'); 

       document.getElementById('formButtons').style.display = "block"; 

        $("input[type=text]").addClass('lifesuite__text-input'); 
        $("input[type=text].hasDatepicker").addClass('dateField'); 
        $("select").addClass('lifesuite__select-input'); 
        $("input[type=radio]").addClass('lifesuite__radio'); 
        $("input[type=checkbox]").addClass('lifesuite__checkbox'); 
        $("textarea").addClass('lifesuite__textarea-input'); 
        $('label').addClass('lifesuite__input-label lifesuite__inputâ€”block'); 

  $('#sweden-employment-agreement').on('click change', 'input:visible[type="radio"]', function() {
    if(!strFormCompleted) {
      validateField($(this));
    }
  });

  $('#sweden-employment-agreement').on('change', 'input:visible:not(#signature):not(:button), select:visible', function() {
    if(!strFormCompleted) {
      validateField($(this));
    }
  });

  $('#modal').on('click', 'input.lifesuite__button', function() {
    if(!strFormCompleted) {
      validateField($('#signature'));
      validateField($('#sign-date-container .cal_and_button input:not(:button)'), true);
    }
  });

  $('#modal2').on('click', 'input.lifesuite__button', function() {
    if(!strFormCompleted) {
      validateField($('#signature2'));
      validateField($('#sign-date-container2 .cal_and_button input:not(:button)'), true);
    }
  });

  $('#ButtonPrint, #buttonPrint, #ButtonSaveAndComplete, #buttonSaveAndComplete').on('click', function(e) {
    var formIsValid = true, btn = $(this);
    e.preventDefault();
    $.each($('#sweden-employment-agreement input:visible:not(:button):not(.hasDatepicker), #sweden-employment-agreement select:visible'), function(k, v) {
      if(!$("input.calendar_button").length) formIsValid = true;
      else{
            if(false == validateField($(v)) && $(v).is(':visible')) {
              formIsValid = false;
            }
      }
    });
    if (formIsValid) {
      switch (btn.attr('id')) {
        case 'ButtonPrint':
          $('.marked').popover('hide');
          $('.popover').remove();
          funcPrint();
        break;
        case 'ButtonSaveAndComplete':
          completeStamp("<$client.env.eval((client.role.rc_sweden_company_signatory==1)?'SignatoryStamp':'')>");
          completeStamp("<$client.env.eval((url.forWhom==account.userguid)?'EmployeeStamp':'')>");
          $('.marked').popover('hide');
          $('.popover').remove();
          funcSaveAndComplete();
        break;
      }
    }
  });

  // clearing fields after reopening task starts here
  var assignee = "<$client.account.username_first> <$client.account.username>";
  var rec_name =  document.getElementById('Signatory');
  var emp_name = document.getElementById('name'); 
  var isSignatory = <$client.env.eval((client.role.rc_sweden_company_signatory==1)?'true':'false')>;
  var isEmployee = <$client.env.eval((url.forWhom==account.userguid)?'true':'false')>;
  var init = function() {
    if($('#SignatoryStamp').prop('readonly')) {
      $('#signature, #signature2, .startDate').prop('onfocus',null);
      return false;
    }
    if (isSignatory && parseInt($('#SignatoryStamp').val()) === 0) { /* Fix client issue (When the company signatory signs or employee signs, the company signatory completed signature information is not captured. ) - 2018-09-07*/
      $('#company-signatory-complementary').addClass('highlight-now');
      $('#signature2, #name').val('');
      $('#SignatoryStamp').val(1);
      setTimeout(function() {
        $('.signDate2, #sv2').val('');
      }, 400);
    }
    if (isSignatory || (isEmployee &&  parseInt($('#EmployeeStamp').val()) === 0)) {
      $('#signature').val(''); 
      $('#EmployeeStamp').val(1);
      setTimeout(function() {
        $('.signDate, #sv').val('');
      }, 400);
    }
   if(!isEmployee && !isSignatory) {
      $('#signature2, #signature, #Signatory, #name, #sv, #sv2').val('');
      setTimeout(function() {
        $('.signDate, .signDate2').val('');
      }, 400);
    }
  }
  setTimeout(init(),400);

  if(!$('#signature2').val().length) {
    rec_name.value = <$client.env.eval((client.role.rc_sweden_company_signatory==1)?'assignee':'null')>;
  }
  if(!$('#signature').val().length) {
    emp_name.value = <$client.env.eval((url.forWhom==account.userguid)?'assignee':'null')>;
  } 

  $('#company-signatory-complementary').text($('#Signatory').val());

  var isIE = function() {
    var ua = window.navigator.userAgent;
    var msie = ua.indexOf("MSIE ");
    if (msie > 0 || navigator.userAgent.match(/Trident.*rv\:11\./)) {
        return true;
    }
    return false;
  }
  if (isIE()) {
    $('ol.outer-list').addClass('ie-list');
  }

  // focus to modal field fix
  let focusSigFields = setInterval(function(){ 
    "use strict";
    if(document.getElementById('modal').style.display=='block') {
      document.getElementById('ButtonSaveAndComplete').focus();
      document.getElementById('eSignature1').focus();
      clearInterval(focusSigFields) 
    }
    if(document.getElementById('modal2').style.display=='block') {
      document.getElementById('ButtonPrint').focus();
      document.getElementById('eSignature2').focus();
      clearInterval(focusSigFields) 
    }
  }, 500);

  // dynamic fields marking
  let isNewhire = $('#hidden_pg').prop('readonly') || <$client.env.eval((url.forWhom==account.userguid)?'true':'false')>;

  if (isNewhire) { 
    $('#tablePopup').addClass('deactivate-highlight'); 
  }

  // When the field is not populated, the form should display a highlighted blank space. 
  $('mark').each(function(x){ 
    if($('mark').eq(x).html().length <= 0){ 
      $('mark').eq(x).html('&nbsp;'); 
    } 
  });

  let loadFriendlyTexts = function() { 
    if (!isNewhire) { 
      setTimeout(function() { 
        $('.marked').popover({ 
          'trigger': 'manual' 
        }).popover('show'); 
        $('.popover-content').addClass('text-uppercase') 
      }, 500);  
    } 
  } 

  loadFriendlyTexts(); 

  $(window).on('resize', function() { 
    loadFriendlyTexts(); 
  });

});

$('#buttonPrint').removeAttr('onclick');
$('#buttonSaveAndComplete').removeAttr('onclick');
disableCalButton('.disableDate');
$( window ).resize(function() {
  document.getElementById('over').style.width='';
});
</script>
