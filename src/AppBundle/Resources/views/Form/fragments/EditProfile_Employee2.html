<div id="task_summary_outer">
    <div id="EditProfile_container">
        <div id="EditProfile_wrapper">
            <div id="EditProfile">
              <h2>Personal Information</h2>                     
         
               <div class="input_wrapper" data-fieldgroup-title="Legal first name" data-fieldgroup-validation="required">
                <span class="floating-label">Legal first name</span>
                <input type="text" id="First_Name" name="First_Name" value="<$client.tForWhomUserInfo.First_Name>" >
              </div>

               <div class="input_wrapper" data-fieldgroup-title="Legal middle name" >
                <span class="floating-label">Legal middle name</span>
                <input type="text" id="Middle_Name" name="Middle_Name" value="<$client.tForWhomUserInfo.Middle_Name>" >
              </div>

              <div class="input_wrapper" data-fieldgroup-title="Legal last name" data-fieldgroup-validation="required">
                <span class="floating-label">Legal last name</span>
                <input type="text" id="Last_Name" name="Last_Name" value="<$client.tForWhomUserInfo.Last_Name>" >
              </div>

              <div class="input_wrapper" data-fieldgroup-title="Personal Email address" data-fieldgroup-validation="required">
                <span class="floating-label">Personal Email address</span>
                <input type="text" id="Email" name="Email" value="<$client.tForWhomUserInfo.Email>">
              </div> 

<div class="input_wrapper" data-fieldgroup-title="Social Security Number" data-fieldgroup-validation="required">
                <span class="floating-label">Social Security Number</span>
                 <$client.env.inputSSNO>
              </div> 

<div class="input_wrapper" data-fieldgroup-title="Social Security Number confirmation">
                <span class="floating-label">Social Security Number Confirmation</span>
                 <$client.env.inputSSN_Match>
              </div> 

<div class="input_wrapper" data-fieldgroup-title="Birth Date" data-fieldgroup-validation="required">
                <span class="floating-label">Birth Date</span>
                 <$client.env.inputDOB>
              </div> 

<div class="input_wrapper" data-fieldgroup-title="Date of Birth confirmation">
                <span class="floating-label">Date of Birth Confirmation</span>
                 <$client.env.inputDOB_Match>
              </div> 

               <div class="input_wrapper" data-fieldgroup-title="Address line 1" data-fieldgroup-validation="required">
                <span class="floating-label">Address line 1</span>
                 <$client.env.inputAddress1>
              </div>   

              <div class="input_wrapper" data-fieldgroup-title="Address line 2">
                <span class="floating-label">Address line 2</span>
                <$client.env.inputAddress2>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="City" data-fieldgroup-validation="required">
                <span class="floating-label">City</span>
                 <$client.env.inputCity>
              </div>  

              <div class="input_wrapper" data-fieldgroup-title="State" data-fieldgroup-validation="required">
                <span class="floating-label">State</span>
                 <$client.env.inputState>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Zip Code" data-fieldgroup-validation="required,regex-optional" data-fieldgroup-regex="^\d{5}$" data-fieldgroup-message="5 digits only">
                <span class="floating-label">Zip Code</span>
                 <$client.env.inputZip>
              </div>  

              <div class="input_wrapper" data-fieldgroup-title="Personal Mobile Number" data-fieldgroup-validation="required,regex-optional" data-fieldgroup-regex="^\d{10}$" data-fieldgroup-message="a valid phone number">
                <span class="floating-label">Personal Mobile Number</span>
                 <$client.env.inputPhone>
              </div>

 <h2>EEO Information</h2>  

              <div class="input_wrapper" data-fieldgroup-title="Marital Status" data-fieldgroup-validation="required">
                <span class="floating-label">Marital Status</span>
                 <$client.env.inputMaritalStatus>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Ethnicity" data-fieldgroup-validation="required">
                <span class="floating-label">Ethnicity</span>
                 <$client.env.inputEthnicity>
              </div> 


              <div class="input_wrapper" data-fieldgroup-title="Gender" data-fieldgroup-validation="required">
                <span class="floating-label">Gender</span>
                 <$client.env.inputGender>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Disabled" data-fieldgroup-validation="required">
                <span class="floating-label">Disabled</span>
                 <$client.env.inputDisability_Status>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Veteran Status" data-fieldgroup-validation="required">
                <span class="floating-label">Veteran Status</span>
                 <$client.env.inputVeteran_Status>
              </div> 



 <h2>Primary Emergency Contact Information</h2>  

              <div class="input_wrapper" data-fieldgroup-title="Primary Contact Name" data-fieldgroup-validation="required">
                <span class="floating-label">Primary Contact Name</span>
                 <$client.env.inputEmerg_Name1>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Primary Contact Phone Number" data-fieldgroup-validation="required,regex-optional"data-fieldgroup-regex="^\d{10}$" data-fieldgroup-message="a valid phone number">
                <span class="floating-label">Primary Contact Phone Number</span>
                 <$client.env.inputEmerg_Phone1>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Primary Contact Email" data-fieldgroup-validation="required">
                <span class="floating-label">Primary Contact Email</span>
                 <$client.env.inputEmerg_Email1>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Primary Contact Relationship" data-fieldgroup-validation="required">
                <span class="floating-label">Primary Contact Relationship</span>
                 <$client.env.inputEmerg_Relation1>
              </div> 

<section class="emergency-contact-information-section">
 <h2>Secondary Emergency Contact Information</h2>  


            <div class="input_wrapper" data-fieldgroup-title="Secondary Contact Name" data-fieldgroup-validation="required">
                <span class="floating-label">Secondary Contact Name</span>
                 <$client.env.inputEmerg_Name2>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Secondary Contact Phone Number" data-fieldgroup-validation="required,regex-optional" data-fieldgroup-regex="^\d{10}$" data-fieldgroup-message="a valid phone number">
                <span class="floating-label">Secondary Contact Phone Number</span>
                 <$client.env.inputEmerg_Phone2>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Secondary Contact Email" data-fieldgroup-validation="required">
                <span class="floating-label">Secondary Contact Email</span>
                 <$client.env.inputEmerg_Email2>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Secondary Contact Relationship" data-fieldgroup-validation="required">
                <span class="floating-label">Secondary Contact Relationship</span>
                 <$client.env.inputEmerg_Relation2>
              </div> 
              <div class="input_wrapper clearfix">
                  <button class="lifesuite__button bg-ignite remove-emergency-contact-information-section pull-right" type="button" role="button">Remove</button>
              </div>
</section>
<div class="input_wrapper mb-18">
    <button id="add-secondary-emergency-contact-information" type="button" role="button" class="lifesuite__button bg-jade pull-right">Add Secondary Emergency Contact Information</button>
</div>

 <h2>Primary Beneficiary Information</h2>  


            <div class="input_wrapper" data-fieldgroup-title="Primary Beneficiary Name" data-fieldgroup-validation="required">
                <span class="floating-label">Primary Beneficiary Name</span>
                 <$client.env.inputBeneficiary_Name>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Primary Beneficiary Phone Number" data-fieldgroup-validation="required,regex-optional" data-fieldgroup-regex="^\d{10}$" data-fieldgroup-message="a valid phone number">
                <span class="floating-label">Primary Beneficiary Phone Number</span>
                 <$client.env.inputBeneficiary_Phone>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Primary Beneficiary Email" data-fieldgroup-validation="required">
                <span class="floating-label">Primary Beneficiary Email</span>
                 <$client.env.inputBeneficiary_Email>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Primary Beneficiary Relationship" data-fieldgroup-validation="required">
                <span class="floating-label">Primary Beneficiary Relationship</span>
                 <$client.env.inputBeneficiary_Relation>
              </div> 

<section class="beneficiary-information-section">
 <h2>Secondary Beneficiary Information</h2>  

   <div class="input_wrapper" data-fieldgroup-title="Secondary Beneficiary Name" data-fieldgroup-validation="required">
                <span class="floating-label">Secondary Beneficiary Name</span>
                 <$client.env.inputBeneficiary_Name2>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Secondary Beneficiary Phone Number" data-fieldgroup-validation="required,regex-optional" data-fieldgroup-regex="^\d{10}$" data-fieldgroup-message="a valid phone number">
                <span class="floating-label">Secondary Beneficiary Phone Number</span>
                 <$client.env.inputBeneficiary_Phone2>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Secondary Beneficiary Email" data-fieldgroup-validation="required">
                <span class="floating-label">Secondary Beneficiary Email</span>
                 <$client.env.inputBeneficiary_Email2>
              </div> 

              <div class="input_wrapper" data-fieldgroup-title="Secondary Beneficiary Relationship" data-fieldgroup-validation="required">
                <span class="floating-label">Secondary Beneficiary Relationship</span>
                 <$client.env.inputBeneficiary_Relation2>
              </div> 
              <div class="input_wrapper clearfix">
                  <button class="lifesuite__button bg-ignite remove-beneficiary-information-section pull-right" type="button" role="button">Remove</button>
              </div>
</section>
<div class="input_wrapper mb-18">
    <button id="add-secondary-beneficiary-information" type="button" role="button" class="lifesuite__button bg-jade pull-right">Add Secondary Beneficiary Information</button>
</div>

              <div class='row'>
                &nbsp;
              </div>

           
              <div style='display:none'>

              </div>            

              <div class="button_group">
                <div id="save" class="input_wrapper clearfix mb-15"></div>
                <div id="saveandcomplete" class="input_wrapper clearfix"></div>
                <div id="cancel" class="input_wrapper clearfix"></div>
              </div>
                
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="<$link;/main/RedCarpet/FormTemplates/FormSupport/js/moment-with-locales.min.js>"></script>
<script type="text/javascript" src="<$link;/main/RedCarpet/FormTemplates/FormSupport/js/jquery.mask.min.js>"></script>
<script type="text/javascript" src="<$link;/main/RedCarpet/FormTemplates/FormSupport/js/front_validator.js>" defer></script>

<!-- configuration files and libraries are included here  -->
<script type="text/javascript" src="<$link;/map_images/main/SiteGen/Onboarding/Content/UnplacedPages/shared/vex.min.js>"></script>
<script type="text/javascript">
    const providerContext = document.getElementById('EditProfile');
    const focusInputLabel = function(el, isFocused) {
        "use strict";
        let label = el.closest('.input_wrapper')
            .find('span.floating-label')
            .removeClass('label-focus')
            .css({"color": "#1C1C1C"});
        if (el.is('select') && el.val() === null) {
            return;
        }
        if (el.val().trim().length > 0 || isFocused) {
            label.addClass('label-focus');
        }
        if (isFocused === true) {
            label.css({"color": "#1C1C1C"});
        }
    }
    const fieldHasVal = function(el) {
        "use strict";
        let hasVal = false;
        $.each(el, function(k, v) {
            if ($(v).val().length) {
                hasVal = true;
            }
        });
        return hasVal;
    }
    const isCheckboxChecked = function(el) {
        "use strict";
        let hasChecked = false;
        $.each(el, function(k,v){
            if ($(v).is(':checked')) {
                hasChecked = true;
            }
        });
        return hasChecked;
    }

    // define callback validators
   /* const employeeIDValidator = function() {
        "use strict";
        const employeeField = $('#Employee_HRISID');
        let isValid = true;
        let message = '';
        if (employeeField.val().length > 0 && !/^00[0-9]*$/.test(employeeField.val())) {
            isValid = false;
            message = 'Employee ID must always start with 00';
        }
        return {
            "isValid": isValid,
            "message": message
        }
    }*/

    // email validator
    const EMAIL_REG = /^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;
    const emailFormatValidator = function(v) {
      "use strict";
      let isValid = true;
      let message = '';
      if (!EMAIL_REG.test(v)) {
        isValid = false;
        message = 'Please enter a valid email address.';
      }
      return {
        "isValid": isValid,
        "message": message
      }
    }

  const ssnConfirmationValidator = function() {
      "use strict";
      let isValid = true;
      let message = '';
      if (!$('[name$="SSN_Match"]').val().length) {
        isValid = false;
        message = 'Social Security Number confirmation is required.';
      }
      if ($('[name$="SSN_Match"]').val().length && $('[name$="SSNO"]').val() != $('[name$="SSN_Match"]').val()) {
        isValid = false;
        message = 'SSNs entered do not match. Please re-enter.';
      }
      return {
        "isValid": isValid,
        "message": message
      }
    }

  const dobConfirmationValidator = function() {
      "use strict";
      let isValid = true;
      let message = '';
      if (!$('[name$="DOB_Match"]').val().length) {
        isValid = false;
        message = 'Date of Birth confirmation is required.';
      }
      if ($('[name$="DOB_Match"]').val().length && $('[name$="DOB_display"]').val() != $('[name$="DOB_Match"]').val()) {
        isValid = false;
        message = 'DOBs entered do not match. Please re-enter.';
      }
      return {
        "isValid": isValid,
        "message": message
      }
    }

  function dob16plus(el) {
    "use strict";
    let isValid = true;
    let message = '';
    let strStartDate = el.val();
    let arrStartDate = strStartDate.split("/");
    let intYear = parseInt(arrStartDate[2],10);
  
    let intYear16 = intYear + 16;
    
    let year16 = intYear16 + "-" + arrStartDate[0] + "-" + arrStartDate[1];
    
    let todayDate = "<$client.env.eval(date.now('%Y-%m-%d'))>";
    if(todayDate<year16){
      isValid = false;
      message = 'Date of Birth must indicate an age of 16 or older.';
    }
    return {
      "isValid": isValid,
      "message": message
    }
  }

  function ssn9Digits(el) {
    "use strict";
    let isValid = true;
    let message = '';
    let regExp = new RegExp('^\\d{9}$');
    if (regExp.test(el.val()) == false) {
      isValid = false;
      message = 'SSN must be 9 characters, digits only.';
    }
    return {
      "isValid": isValid,
      "message": message
    }
  }
    



    vex.defaultOptions.className = 'vex-theme-top';

    $(window).on('load', function() {
        "use strict";
        $('.floating-label span').css('color', 'rgb(102, 102, 102)');
        $('.cal_and_button').prop({'cellpadding': 0, 'cellspacing': 0});
        let isProfileCompleted = sTaskComplete;
        // replace default submit button with paypal styled
        $('#TaskSummary_ButtonCancel').appendTo('#cancel').show();
        if (!isProfileCompleted) {
            $('#TaskSummary_ButtonSave').appendTo('#saveandcomplete').prop('onclick', null).show().text('Save & Complete');
            $('#EUPDefaultSaveButton').prop('onclick', null).appendTo('#save').show();
        }
        $('textarea').addClass('lifesuite__textarea-input');

        // remove all empty radio
        // $('#EditProfile input[type="radio"][value=""]').closest('.horizontal_radio_item').remove();

        // load form when all set
        $('#EditProfile_wrapper').fadeIn();

        //<$include;/main/RedCarpet/FormTemplates/FormSupport/js/global_date_config.js>


        // Show Severance Eligible
        if ("<$client.tEventCategories_Category_33.Value>" != "GA - Calculation" && "<$client.tEventCategories_Category_33.Value>" != "GA - Lump Sum" && "<$client.tEventCategories_Category_33.Value>" != "Ind - Calculation"   && "<$client.tEventCategories_Category_33.Value>" != "Ind - Lump Sum") {
            $('[name$="Severance_Eligible"]').val('');
            $('[name$="Severance_Eligible"]').closest('.input_wrapper').hide();
        }

         // Show ADEA/OWBPA
        if ("<$client.tEventCategories_Category_33.Value>" != "GA - Calculation" && "<$client.tEventCategories_Category_33.Value>" != "GA - Lump Sum") {
            $('[name$="ADEA_Owbpa"]').val('');
            $('[name$="ADEA_Owbpa"]').closest('.input_wrapper').hide();
        }

           $('#Notification_Date, #Original_Hire_Date_pseudo, #Final_PayPeriod_pseudo, #Next_PayCycle_pseudo #DOB_confirmation').datepicker({
            changeMonth: true,
            changeYear: true,
            yearRange: "-100:+100",
            onSelect: function(dateText, instance) {
              validateField($(this)); 
              focusInputLabel($(this));
            }
          });
        //set default value 
        $('#Notification_Date').datepicker('setDate', new Date('<$client.tEventDates_Date_11.Value>'));


        if ('<$client.tForWhomUserInfo.Original_Hire_Date>'.length) {
          $('#Original_Hire_Date_pseudo').datepicker('setDate', new Date('<$client.tForWhomUserInfo.Original_Hire_Date>'));
        }

        //set default value 
        $('#Separation_Date').val('<$client.env.eval(client.tEventDates_10.Value.subString(5,6))>/<$client.env.eval(client.tEventDates_10.Value.subString(8,9))>/<$client.env.eval(client.tEventDates_10.Value.subString(0,3))>');

        if('<$client.tForWhomUserInfo.Final_PayPeriod>'.length) {
            $('#Final_PayPeriod_pseudo').datepicker('setDate', new Date('<$client.tForWhomUserInfo.Final_PayPeriod>'));
        }

        $('#Final_PayPeriod_pseudo').datepicker("option", "onSelect", function(dateText, instance) {
          $('[name$=".Final_PayPeriod_display"]', providerContext).datepicker('setDate', $(this).datepicker('getDate'));
          validateField($(this)); 
          focusInputLabel($(this));
        });



        if ('<$client.tForWhomUserInfo.Next_PayCycle>'.length) {
            $('#Next_PayCycle_pseudo').datepicker('setDate', new Date('<$client.tForWhomUserInfo.Next_PayCycle>'));
        }

        $('#Next_PayCycle_pseudo').datepicker("option", "onSelect", function(dateText, instance) {
          $('[name$=".Next_PayCycle_display"]', providerContext).datepicker('setDate', $(this).datepicker('getDate'));
          validateField($(this)); 
          focusInputLabel($(this));
        });

       


        // Year_Service calculation
       $('#Original_Hire_Date_pseudo').datepicker("option", "onSelect", function(dateText, instance) {
        $('[name$=".Original_Hire_Date_display"]', providerContext).datepicker('setDate', $(this).datepicker('getDate'));
            validateField($(this)); 
            focusInputLabel($(this));
            var Original_Hire_Date_Year = $('#Original_Hire_Date_pseudo').val().toString().slice(6,10);
            var Today_Date_Year = "<$client.env.eval(date.now('%Y'))>";
            var Original_Hire_Date_Month = $('#Original_Hire_Date_pseudo').val().toString().slice(0,2);
            var Today_Date_Month = "<$client.env.eval(date.now('%m'))>";

            var getMonthsDifference = 12 - (parseInt(Original_Hire_Date_Month) - parseInt(Today_Date_Month));

            var getYearDifference = parseInt(Today_Date_Year) - parseInt(Original_Hire_Date_Year);

            if(getMonthsDifference == 12){
                getMonthsDifference = 0;
                getYearDifference + 1;
            }else if(getMonthsDifference > 12){
                getYearDifference + 1;
                getMonthsDifference = getMonthsDifference - 12;
            }else if(getMonthsDifference < 12){
                getYearDifference = getYearDifference - 1;
            }
        




            
            $('[name$=".Year_Service"]').val(getYearDifference + '.' + getMonthsDifference);
            focusInputLabel($('[name$=".Year_Service"]'));
        });

        $('#Original_Hire_Date_pseudo').on('change', function() {
            var Original_Hire_Date_Year = $('#Original_Hire_Date_pseudo').val().toString().slice(6,10);
          var Today_Date_Year = "<$client.env.eval(date.now('%Y'))>";
          var Original_Hire_Date_Month = $('#Original_Hire_Date_pseudo').val().toString().slice(0,2);
          var Today_Date_Month = "<$client.env.eval(date.now('%m'))>";

          var getMonthsDifference = 12 - (parseInt(Original_Hire_Date_Month) - parseInt(Today_Date_Month));

          var getYearDifference = parseInt(Today_Date_Year) - parseInt(Original_Hire_Date_Year);

          if(getMonthsDifference == 12){
            getMonthsDifference = 0;
            getYearDifference + 1;
          }else if(getMonthsDifference > 12){
            getYearDifference + 1;
            getMonthsDifference = getMonthsDifference - 12;
          }else if(getMonthsDifference < 12){
            getYearDifference = getYearDifference - 1;
          }
     
         
          $('[name$=".Year_Service"]').val(getYearDifference + '.' + getMonthsDifference);
          focusInputLabel($('[name$=".Year_Service"]'));
        });

        $('#Original_Hire_Date_pseudo').trigger('change');

        // hide show fields/sections that has contents
        // show secondary emergency contact information that are filled
        $('.emergency-contact-information-section input:not([type="hidden"]), .emergency-contact-information-section select').each(function(k,v) {
            if (fieldHasVal($(v))) {
                $(v).closest('.emergency-contact-information-section').show();
            }
        });
        // show first if none is filled
        const additionalEmergencyContactInformationSections = $('.emergency-contact-information-section:visible');
        if (additionalEmergencyContactInformationSections.length == 1) {
            $('#add-secondary-emergency-contact-information').hide();
        }

        // show secondary beneficiary information that are filled
        $('.beneficiary-information-section input:not([type="hidden"]), .beneficiary-information-section select').each(function(k,v) {
            if (fieldHasVal($(v))) {
                $(v).closest('.beneficiary-information-section').show();
            }
        });
        // show first if none is filled
        const additionalBeneficiaryInformationSections = $('.emergency-contact-information-section:visible');
        if (additionalBeneficiaryInformationSections.length == 1) {
            $('#add-secondary-beneficiary-information').hide();
        }

        // show sections by event triggers
        // show secondary emergency contact information fields
        $('#add-secondary-emergency-contact-information').on('click', function() {
            $('.emergency-contact-information-section:hidden').first().show();
            if ($('.emergency-contact-information-section:hidden').length < 1) {
                $(this).hide();
                return;
            }
            $('.remove-emergency-contact-information-section').show();
        });

        // show secondary beneficiary information fields
        $('#add-secondary-beneficiary-information').on('click', function() {
            $('.beneficiary-information-section:hidden').first().show();
            if ($('.beneficiary-information-section:hidden').length < 1) {
                $(this).hide();
                return;
            }
            $('.remove-beneficiary-information-section').show();
        });

        // hide sections by event triggers
        // hide secondary language information fields
        $('.remove-emergency-contact-information-section').on('click', function() {
            const section = $(this).closest('section').hide();
            const hiddenFields = section.find('input:not([type="hidden"]), select');
            section.find('input:not([type="hidden"]):not(:radio), select').val('');
            section.find('input:radio').prop('checked', false);
            focusInputLabel(hiddenFields);
            hiddenFields.each(function(k,v) {
                validateField($(v), true);
            });
            if ($('.emergency-contact-information-section:visible').length < 9) {
                $('#add-secondary-emergency-contact-information').show();
            }
        });

        // hide secondary language information fields
        $('.remove-beneficiary-information-section').on('click', function() {
            const section = $(this).closest('section').hide();
            const hiddenFields = section.find('input:not([type="hidden"]), select');
            section.find('input:not([type="hidden"]):not(:radio), select').val('');
            section.find('input:radio').prop('checked', false);
            focusInputLabel(hiddenFields);
            hiddenFields.each(function(k,v) {
                validateField($(v), true);
            });
            if ($('.beneficiary-information-section:visible').length < 9) {
                $('#add-secondary-beneficiary-information').show();
            }
        });

        $('[name$=".DOB_display"]', providerContext).on('change', function() {
            validateField($('[name$=".DOB_display"]'), false, function() {
                return dob16plus($('[name$=".DOB_display"]'));
            });
        });

        $('[name$=".SSNO"]', providerContext).on('change', function() {
            validateField($('[name$=".SSNO"]'), false, function() {
                return ssn9Digits($('[name$=".SSNO"]'));
            });
        });

        // save and complete laters
        $('#EUPDefaultSaveButton').on('click', function(e) {
            e.preventDefault();
            var original_Email = "<$client.tForWhomUserInfo.Email>";
            if ($('#Email').val().length < 1) {
                $('#Email').val(original_Email);
                focusInputLabel($('[name$=".Email"]'));
            }
            if (!EMAIL_REG.test($('#Email').val())) {
                $('#Email').val(original_Email);
                focusInputLabel($('[name$=".Email"]'));
            }
            DisableValidation();doSave_Custom('refer-Save');
        });

     
      
        // focus style text and select fields
        $('form').on('focus', 'input[type="text"], select, textarea', function() {
            focusInputLabel($(this), true);
        }).on('blur', 'input[type="text"], select, textarea', function() {
            focusInputLabel($(this));
        });
        // focus field labels
        $.each($('form input[type="text"], form select, textarea'),function(k,v) {
            focusInputLabel($(v));
        });

        // pass validation data to each fields
        $.each($('[data-fieldgroup-validation]'), function(k,v) {
            $(v).find('input, select, textarea').data('validation', $(v).data('fieldgroup-validation'));
        });
        // pass regex data to each fields
        $.each($('[data-fieldgroup-regex]'), function(k,v) {
            $(v).find('input, textarea').data('regex', $(v).data('fieldgroup-regex'));
        });
        // pass regex message to each fields
        $.each($('[data-fieldgroup-message]'), function(k,v) {
            $(v).find('input, textarea').data('message', $(v).data('fieldgroup-message'));
        });
        // pass validation data length to each fields
        $.each($('[data-fieldgroup-minlength]'), function(k,v) {
            $(v).find('input, textarea').data('minlength', $(v).data('fieldgroup-minlength'));
        });
        $.each($('[data-fieldgroup-maxlength]'), function(k,v) {
            $(v).find('input, textarea').data('maxlength', $(v).data('fieldgroup-maxlength'));
        });
        // pass target label to each radio or checkbox fields
        $.each($('[data-fieldgroup-targetlabel]'), function(k,v) {
            $(v).find('input[type="checkbox"], input[type="radio"]').data('label', $(v).data('fieldgroup-targetlabel'));
        });
        // pass title data to each fields
        $.each($('[data-fieldgroup-title]'), function(k,v) {
            $(v).find('input, select, textarea').data('title', $(v).data('fieldgroup-title'));
        });

        $('form').on('change', 'input[type="checkbox"], input[type="radio"]', function() {
            validateField($(this));
        });
        // validate each field by event and field type
        $('input:not(".datepicker_button"), select, textarea', providerContext).on('blur click', function() {
            const thisVal = this.value;
            // static email validation
            if ($(this).prop('name') == 'Email' && $(this).val().length > 0) {
              return validateField($(this), false, function() {
                return emailFormatValidator(thisVal)
              })
            }
            // re-validate field with custom validation
            switch ($(this).prop("name").split(".")[1]) {
                  case "Emerg_Email1": 
                  case "Emerg_Email2": 
                  case "Beneficiary_Email": 
                  case "Beneficiary_Email2": 
                  return validateField($(this), false, function() {
                    return emailFormatValidator(thisVal)
                  });
                  break;
                  case "DOB_display": validateField($(this), false, function() {
                            return dob16plus($('[name$=".DOB_display"]'));
                        });
                        break;
                  case "SSNO": validateField($(this), false, function() {
                            return ssn9Digits($('[name$=".SSNO"]'));
                        });
                        break;
                  case "SSN_Match": 
                  validateField($(this), false, function() {
                    return ssnConfirmationValidator(); 
                  })
                  break;
                  case "DOB_Match": 
                  validateField($(this), false, function() {
                    return dobConfirmationValidator(); 
                  })
                  break;
            }
            validateField($(this), true);
            if($(this).is(':visible') && !validateField($(this))) {
                $(this).parent().find('.text-error').css({'display': 'inline-block', 'margin-bottom': '-2px'}); // style hack since IE is such a reliable browser ;-) // changed block to inline-block
            }
        });


        // submit the form if no errors
        $('#TaskSummary_ButtonSave', providerContext).on('click', function(e) {
            e.preventDefault();
            let formIsValid = true;
            errorMapping.clear();
            $.each($('input:not(".datepicker_button"), select, textarea', providerContext), function(k,v) {
                if($(v).is(':visible') && !$(v).is(':disabled') && !validateField($(v))) {
                    formIsValid = false;
                }
                // if ($(v).prop('name') == 'Email' && $(v).val().length > 0 && !validateField($(v), false, emailFormatValidator)) {
                    // formIsValid = false;
                // }
                // re-validate field with custom validation
                switch ($(v).prop("name").split(".")[1]) {
                  case "Emerg_Email1": 
                  case "Emerg_Email2": 
                  case "Beneficiary_Email": 
                  case "Beneficiary_Email2": 
                  case "Email": if (!validateField($(v), false, function() { return emailFormatValidator($(v).val()); })) {
                            formIsValid = false;
                        }
                        break;
                  case "DOB_display": if (!validateField($(v), false, function() { return dob16plus($('[name$=".DOB_display"]')); })) {
                            formIsValid = false;
                        }
                        break;
                  case "SSNO": if (!validateField($(v), false, function() { return ssn9Digits($('[name$=".SSNO"]')); })) {
                            formIsValid = false;
                        }
                        break;
                  case "SSN_Match": if (!validateField($(v), false, function() { return ssnConfirmationValidator(); })) {
                            formIsValid = false;
                        }
                        break;
                  case "DOB_Match": if (!validateField($(v), false, function() { return dobConfirmationValidator(); })) {
                            formIsValid = false;
                        }
                        break;
                }
            });
            if (formIsValid) {
                doSave_Custom('refer-Complete');
                return true;
            }
            $("html, body").animate({ scrollTop: 0 }, "slow");
            
        });
        if (isProfileCompleted) {
            $('[data-add-section], [data-remove-section]').removeClass('bg-jade bg-ignite').addClass('disabled').prop('disabled', 'disabled');
            $('input,select', providerContext).prop('disabled', 'disabled');
            $('textarea', providerContext).prop('readonly', true);
        }
    });


</script>
